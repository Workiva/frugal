// Autogenerated by Frugal Compiler (2.12.0)
// DO NOT EDIT UNLESS YOU ARE SURE THAT YOU KNOW WHAT YOU ARE DOING

package music

import (
	"bytes"
	"encoding/json"
	"fmt"
	"io"
	"net/http"
	"reflect"
	"strings"

	"git.apache.org/thrift.git/lib/go/thrift"
	"github.com/Sirupsen/logrus"
	"github.com/Workiva/frugal/lib/gateway"
	"github.com/Workiva/frugal/lib/go"
	"github.com/gorilla/mux"
)

// (needed to ensure safety because of naive import list construction.)
var _ = thrift.ZERO
var _ = fmt.Printf
var _ = bytes.Equal
var _ = logrus.DebugLevel

// RegisterStoreServiceHandler routes requests to the underlying Frugal client
func RegisterStoreServiceHandler(marshaler gateway.Marshaler, router *gateway.Router, client *FStoreClient) error {

	router.HandleFunc("/v1/store/album", func(w http.ResponseWriter, req *http.Request) {
		f, _ := w.(http.Flusher)
		w.Header().Set("Content-Type", marshaler.ContentType())
		var mapping LookupAlbumRequestJSONMapping
		decoder := marshaler.NewDecoder(req.Body)
		defer req.Body.Close()
		err := decoder.Decode(&mapping)
		if err != nil && err != io.EOF {
			if e, ok := err.(*json.UnmarshalTypeError); ok {
				w.WriteHeader(http.StatusUnprocessableEntity)
				response := &ErrorResponse{
					Message: "Validation failed",
					Errors: []*Error{
						&Error{
							Resource: "album",
							Field:    e.Field,
							Code:     "invalid",
						},
					},
				}
				buf, err := marshaler.Marshal(response)
				if err != nil {
					buf = []byte("{ \"message\": \"Validation failed\" }")
				}
				w.Write(buf)
				fmt.Println(e)
				return
			}
			w.WriteHeader(http.StatusBadRequest)
			buf := []byte("{ \"message\": \"Problems parsing JSON\" }")
			w.Write(buf)
			fmt.Println(err)
			return
		}

		payload := &LookupAlbumRequest{}
		s := reflect.ValueOf(&mapping).Elem()
		typeOfMapping := s.Type()
		vars := mux.Vars(req)
		for k, v := range vars {
			varField := strings.ToLower(k)
			for i := 0; i < s.NumField(); i++ {
				structField := strings.ToLower(typeOfMapping.Field(i).Name)
				if varField == structField {
					s.Field(i).Set(reflect.ValueOf(&v))
					continue
				}
			}
		}
		s = reflect.ValueOf(&mapping).Elem()
		typeOfMapping = s.Type()
		queries := req.URL.Query()
		for k, v := range queries {
			varField := strings.ToLower(k)
			for i := 0; i < s.NumField(); i++ {
				structField := strings.ToLower(typeOfMapping.Field(i).Name)
				if varField == structField {
					if len(v) == 1 {
						s.Field(i).Set(reflect.ValueOf(&v[0]))
					} else {
						s.Field(i).Set(reflect.ValueOf(&v[0]))
					}
					continue
				}
			}
		}
		if mapping.ASIN == nil {
			w.WriteHeader(http.StatusBadRequest)
			buf := []byte("{ \"message\": \"Invalid JSON data\" }")
			w.Write(buf)
			return
		}
		payload.ASIN = *mapping.ASIN
		response, err := client.LookupAlbum(frugal.NewFContext(""), payload)
		if err != nil {
			gateway.DefaultFrugalErrorHandler(marshaler, w, req, err)
			return
		}
		buf, err := marshaler.Marshal(response)
		if err != nil {
			fmt.Printf("Failed to marshal response message %q: %v", response, err)
			return
		}
		w.WriteHeader(http.StatusOK)
		w.Write(buf)
		f.Flush()
	}).Methods("GET")
	router.HandleFunc("/v1/store/album/{asin}", func(w http.ResponseWriter, req *http.Request) {
		f, _ := w.(http.Flusher)
		w.Header().Set("Content-Type", marshaler.ContentType())
		var mapping LookupAlbumRequestJSONMapping
		decoder := marshaler.NewDecoder(req.Body)
		defer req.Body.Close()
		err := decoder.Decode(&mapping)
		if err != nil && err != io.EOF {
			if e, ok := err.(*json.UnmarshalTypeError); ok {
				w.WriteHeader(http.StatusUnprocessableEntity)
				response := &ErrorResponse{
					Message: "Validation failed",
					Errors: []*Error{
						&Error{
							Resource: "album",
							Field:    e.Field,
							Code:     "invalid",
						},
					},
				}
				buf, err := marshaler.Marshal(response)
				if err != nil {
					buf = []byte("{ \"message\": \"Validation failed\" }")
				}
				w.Write(buf)
				fmt.Println(e)
				return
			}
			w.WriteHeader(http.StatusBadRequest)
			buf := []byte("{ \"message\": \"Problems parsing JSON\" }")
			w.Write(buf)
			fmt.Println(err)
			return
		}

		payload := &LookupAlbumRequest{}
		s := reflect.ValueOf(&mapping).Elem()
		typeOfMapping := s.Type()
		vars := mux.Vars(req)
		for k, v := range vars {
			varField := strings.ToLower(k)
			for i := 0; i < s.NumField(); i++ {
				structField := strings.ToLower(typeOfMapping.Field(i).Name)
				if varField == structField {
					s.Field(i).Set(reflect.ValueOf(&v))
					continue
				}
			}
		}
		s = reflect.ValueOf(&mapping).Elem()
		typeOfMapping = s.Type()
		queries := req.URL.Query()
		for k, v := range queries {
			varField := strings.ToLower(k)
			for i := 0; i < s.NumField(); i++ {
				structField := strings.ToLower(typeOfMapping.Field(i).Name)
				if varField == structField {
					if len(v) == 1 {
						s.Field(i).Set(reflect.ValueOf(&v[0]))
					} else {
						s.Field(i).Set(reflect.ValueOf(&v[0]))
					}
					continue
				}
			}
		}
		if mapping.ASIN == nil {
			w.WriteHeader(http.StatusBadRequest)
			buf := []byte("{ \"message\": \"Invalid JSON data\" }")
			w.Write(buf)
			return
		}
		payload.ASIN = *mapping.ASIN
		response, err := client.LookupAlbum2(frugal.NewFContext(""), payload)
		if err != nil {
			gateway.DefaultFrugalErrorHandler(marshaler, w, req, err)
			return
		}
		buf, err := marshaler.Marshal(response)
		if err != nil {
			fmt.Printf("Failed to marshal response message %q: %v", response, err)
			return
		}
		w.WriteHeader(http.StatusOK)
		w.Write(buf)
		f.Flush()
	}).Methods("GET")
	router.HandleFunc("/v1/store/album", func(w http.ResponseWriter, req *http.Request) {
		f, _ := w.(http.Flusher)
		w.Header().Set("Content-Type", marshaler.ContentType())
		var mapping LookupAlbumRequestJSONMapping
		decoder := marshaler.NewDecoder(req.Body)
		defer req.Body.Close()
		err := decoder.Decode(&mapping)
		if err != nil && err != io.EOF {
			if e, ok := err.(*json.UnmarshalTypeError); ok {
				w.WriteHeader(http.StatusUnprocessableEntity)
				response := &ErrorResponse{
					Message: "Validation failed",
					Errors: []*Error{
						&Error{
							Resource: "album",
							Field:    e.Field,
							Code:     "invalid",
						},
					},
				}
				buf, err := marshaler.Marshal(response)
				if err != nil {
					buf = []byte("{ \"message\": \"Validation failed\" }")
				}
				w.Write(buf)
				fmt.Println(e)
				return
			}
			w.WriteHeader(http.StatusBadRequest)
			buf := []byte("{ \"message\": \"Problems parsing JSON\" }")
			w.Write(buf)
			fmt.Println(err)
			return
		}

		payload := &LookupAlbumRequest{}
		s := reflect.ValueOf(&mapping).Elem()
		typeOfMapping := s.Type()
		vars := mux.Vars(req)
		for k, v := range vars {
			varField := strings.ToLower(k)
			for i := 0; i < s.NumField(); i++ {
				structField := strings.ToLower(typeOfMapping.Field(i).Name)
				if varField == structField {
					s.Field(i).Set(reflect.ValueOf(&v))
					continue
				}
			}
		}
		s = reflect.ValueOf(&mapping).Elem()
		typeOfMapping = s.Type()
		queries := req.URL.Query()
		for k, v := range queries {
			varField := strings.ToLower(k)
			for i := 0; i < s.NumField(); i++ {
				structField := strings.ToLower(typeOfMapping.Field(i).Name)
				if varField == structField {
					if len(v) == 1 {
						s.Field(i).Set(reflect.ValueOf(&v[0]))
					} else {
						s.Field(i).Set(reflect.ValueOf(&v[0]))
					}
					continue
				}
			}
		}
		if mapping.ASIN == nil {
			w.WriteHeader(http.StatusBadRequest)
			buf := []byte("{ \"message\": \"Invalid JSON data\" }")
			w.Write(buf)
			return
		}
		payload.ASIN = *mapping.ASIN
		response, err := client.LookupAlbum3(frugal.NewFContext(""), payload)
		if err != nil {
			gateway.DefaultFrugalErrorHandler(marshaler, w, req, err)
			return
		}
		buf, err := marshaler.Marshal(response)
		if err != nil {
			fmt.Printf("Failed to marshal response message %q: %v", response, err)
			return
		}
		w.WriteHeader(http.StatusOK)
		w.Write(buf)
		f.Flush()
	}).Methods("GET")
	router.HandleFunc("/v1/store/album", func(w http.ResponseWriter, req *http.Request) {
		f, _ := w.(http.Flusher)
		w.Header().Set("Content-Type", marshaler.ContentType())
		var mapping BuyAlbumRequestJSONMapping
		decoder := marshaler.NewDecoder(req.Body)
		defer req.Body.Close()
		err := decoder.Decode(&mapping)
		if err != nil && err != io.EOF {
			if e, ok := err.(*json.UnmarshalTypeError); ok {
				w.WriteHeader(http.StatusUnprocessableEntity)
				response := &ErrorResponse{
					Message: "Validation failed",
					Errors: []*Error{
						&Error{
							Resource: "album",
							Field:    e.Field,
							Code:     "invalid",
						},
					},
				}
				buf, err := marshaler.Marshal(response)
				if err != nil {
					buf = []byte("{ \"message\": \"Validation failed\" }")
				}
				w.Write(buf)
				fmt.Println(e)
				return
			}
			w.WriteHeader(http.StatusBadRequest)
			buf := []byte("{ \"message\": \"Problems parsing JSON\" }")
			w.Write(buf)
			fmt.Println(err)
			return
		}

		payload := &BuyAlbumRequest{}
		s := reflect.ValueOf(&mapping).Elem()
		typeOfMapping := s.Type()
		vars := mux.Vars(req)
		for k, v := range vars {
			varField := strings.ToLower(k)
			for i := 0; i < s.NumField(); i++ {
				structField := strings.ToLower(typeOfMapping.Field(i).Name)
				if varField == structField {
					s.Field(i).Set(reflect.ValueOf(&v))
					continue
				}
			}
		}
		s = reflect.ValueOf(&mapping).Elem()
		typeOfMapping = s.Type()
		queries := req.URL.Query()
		for k, v := range queries {
			varField := strings.ToLower(k)
			for i := 0; i < s.NumField(); i++ {
				structField := strings.ToLower(typeOfMapping.Field(i).Name)
				if varField == structField {
					if len(v) == 1 {
						s.Field(i).Set(reflect.ValueOf(&v[0]))
					} else {
						s.Field(i).Set(reflect.ValueOf(&v[0]))
					}
					continue
				}
			}
		}
		fmt.Println(mapping)

		if mapping.Artist == nil {
			w.WriteHeader(http.StatusBadRequest)
			buf := []byte("{ \"message\": \"Invalid JSON data\" }")
			w.Write(buf)
			return
		}
		payload.Artist = *mapping.Artist
		if mapping.Title == nil {
			w.WriteHeader(http.StatusBadRequest)
			buf := []byte("{ \"message\": \"Invalid JSON data\" }")
			w.Write(buf)
			return
		}
		payload.Title = *mapping.Title
		response, err := client.BuyAlbum(frugal.NewFContext(""), payload)
		if err != nil {
			gateway.DefaultFrugalErrorHandler(marshaler, w, req, err)
			return
		}
		buf, err := marshaler.Marshal(response)
		if err != nil {
			fmt.Printf("Failed to marshal response message %q: %v", response, err)
			return
		}
		w.WriteHeader(http.StatusOK)
		w.Write(buf)
		f.Flush()
	}).Methods("post")
	return nil
}
